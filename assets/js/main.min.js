var App={namespace:function(e){for(var t=e.split("."),i=this,s=0,n=t.length;s<n;s++)i[t[s]]=i[t[s]]||{},i=i[t[s]];return i}};App.namespace("Utils").DOM=function(){var e=function(e,t){return(t||document).querySelector(e)},t=function(e,t){return(t||document).querySelectorAll(e)},i=function(e,t){return(t||document).getElementById(e)},s=function(e){return e=e||[],e.forEach(function(e){e.parentNode.removeChild(e)}),[].slice.call(e)},n=function(e){return s(t(e))},o=function(e,t){var i=e.parentNode,s=t.parentNode,n=null;try{i.replaceChild(t.cloneNode(!0),e),s.replaceChild(e.cloneNode(!0),t),n=!0}catch(e){n=!1}return n},a=function(e,t){return t.parentNode.insertBefore(e,t.nextSibling)},r=function(e,t){e.innerHTML=t};return{$:e,$$:t,id:i,removeAll:s,removeAllBySelector:n,swapElements:o,insertAfter:a,innerH:r}}(),App.namespace("Utils").Math=function(){var e=function(e){return parseInt(Math.random()*e,10)};return{getRandom:e}}(),App.namespace("Utils").Array=function(){var e=App.Utils.Math,t=function(e,t){var i=0,s=e.length,n=!1,o=-1;if("function"==typeof Array.prototype.indexOf)return e.indexOf(t);for(;i<s&&!n;)e[i]===t&&(o=i,n=!0),i++;return o},i=function(t){for(var i,s=[],n=t.length;n;)i=e.getRandom(t.length),i in t&&(s.push(t[i]),delete t[i],n--);return s},s=function(e){return[].slice.call(e)};return{indexOf:t,shuffle:i,toArr:s}}(),App.namespace("Utils").Obj=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var t=function(e,t){var i;return t=(t||"").trim().toLowerCase(),i=Object.prototype.toString.call(e).toLowerCase(),i==="[object "+t+"]"},i=function(){var e={},s=!1,n=0,o=arguments.length;t(arguments[0],"Boolean")&&(s=arguments[0],n++);for(var a=function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(s&&t(n[o],"Object")?e[o]=i(!0,e[o],n[o]):e[o]=n[o])};n<o;n++){var r=arguments[n];a(r)}return e},s=function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()};return{extend:i,guid:s}}(),App.namespace("Utils").Events=function(){var e=function(){this.events={}};e.prototype.on=function(e,t){"object"!=typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t)},e.prototype.removeListener=function(e,t){var i;"object"==typeof this.events[e]&&(i=App.Utils.Array.indexOf(this.events[e],t),i>-1&&this.events[e].splice(i,1))},e.prototype.emit=function(e){var t,i,s,n=[].slice.call(arguments,1);if("object"==typeof this.events[e])for(i=this.events[e].slice(),s=i.length,t=0;t<s;t++)i[t].apply(this,n)},e.prototype.once=function(e,t){this.on(e,function i(){this.removeListener(e,i),t.apply(this,arguments)})};var t=function(e,t,i,s){e.addEventListener(t,i,!!s)},i=["webkit","moz","MS","o",""],s=function(e,t,s,n){for(var o=0,a=i.length;o<a;o++)i[o]||(t=t.toLowerCase()),e.addEventListener(i[o]+t,s,!!n)};return{Emitter:e,$on:t,$prefixedOn:s}}(),App.namespace("DateTime").Timer=function(e){function t(e,t){this.isStarted=!1,this.paused=!0,this.timerId=null,this.time=Math.floor(e),this.ID=App.Utils.Obj.guid(),this.step=t||1,this.initialTime=this.getCurrentTime()}return t.prototype=new App.Utils.Events.Emitter,t.prototype.constructor=t,t.prototype.getHours=function(){return Math.floor(this.time/3600)},t.prototype.getMinutes=function(e){var t=this.getHours(),i=Math.floor((this.time-3600*t)/60);return e&&i<10&&(i="0"+i),i},t.prototype.getSeconds=function(e){var t=this.getHours(),i=this.getMinutes(!0),s=this.time-3600*t-60*i;return e&&s<10&&(s="0"+s),s},t.prototype.getCurrentTime=function(){var e=this.getHours(),t=this.getMinutes(!0),i=this.getSeconds(!0);return e+":"+t+":"+i},t.prototype.getInitialTime=function(){return this.initialTime},t.prototype.setTime=function(e,t){this.isStarted&&(this.time=Math.floor(e),this.step=t||1)},t.prototype.count=function(){var t=this.getHours(),i=this.getMinutes(!0),s=this.getSeconds(!0),n=this.getCurrentTime();this.emit(this.ID+"-tick",n,t,i,s),this.time-=this.step,this.time<0&&(e.clearInterval(this.timerId),this.emit(this.ID+"-elapsedTime"))},t.prototype.start=function(){this.isStarted=!0,this.resume()},t.prototype.resume=function(){var t=this;this.paused&&this.time>0&&(this.timerId=e.setInterval(t.count.bind(t),1e3*t.step),this.paused=!1)},t.prototype.pause=function(){this.paused=!0,e.clearInterval(this.timerId)},t.prototype.isPaused=function(){return this.paused},t}(window);var PuzzleModel=function(e,t){"use strict";function i(){this.started=!1,this.preStarted=!1,this.paused=!1,this.isOver=!1,this.pieces=[[45],[41],[37],[33],[29],[43],[39],[35],[31],[44],[40],[36],[32],[28],[42],[38],[34],[30],[27],[18],[14],[10],[6],[25],[16],[12],[8],[26],[17],[13],[9],[5],[24],[15],[11],[7],[23],[22],[21],[20],[19]],this.partial=[],this.settings={audio:{background:"assets/sounds/magic_clock.mp3",swap:"assets/sounds/swap_sound.mp3",broken:"assets/sounds/broken_glass.mp3",countDown:"assets/sounds/countdown.mp3",clapping:"assets/sounds/clapping.mp3",fail:"assets/sounds/fail_effect.mp3"},levels:[{ID:0,name:"easy",time:7,icon:"fa fa-star-o",tips:3},{ID:1,name:"medium",time:5,icon:"fa fa-star-half-o",tips:2},{ID:2,name:"hard",time:3,icon:"fa fa-star",tips:1}]},this.currentLevel=this.settings.levels[0],this.countDownTime=5,this.countDownWrongPiecesTime=1.5,this.missingPieces=this.pieces.length,this.wrongPieces=0,this.tipsTime=5,this.isAudioEnabled=!0}return i.prototype=new App.Utils.Events.Emitter,i.prototype.constructor=i,i.prototype.preStart=function(){this.preStarted||(this.preStarted=!0,this.emit("model.pre-start"))},i.prototype.start=function(){this.started=!0,this.emit("model.start")},i.prototype.gameOver=function(){this.isOver=!0,this.emit("model.gameOver")},i.prototype.isGameOver=function(){return this.isOver},i.prototype.getTipsTime=function(){return this.tipsTime},i.prototype.isStarted=function(){return this.started},i.prototype.pauseGame=function(){this.paused=!0,this.emit("model.pauseGame")},i.prototype.resumeGame=function(){this.paused=!1,this.emit("model.resumeGame")},i.prototype.getAllPieces=function(){return this.pieces},i.prototype.getMissingPieces=function(){return this.missingPieces},i.prototype.decreaseMissingPieces=function(){this.missingPieces-=1,this.emit("model.decreaseMissingPieces",this.missingPieces),0===this.missingPieces&&0===this.wrongPieces&&this.emit("model.winnerUSER",this.missingPieces),0===this.missingPieces&&0!==this.wrongPieces&&this.emit("model.wrongSequence")},i.prototype.increaseMissingPieces=function(){this.missingPieces+=1,this.emit("model.increaseMissingPieces",this.missingPieces)},i.prototype.setWrongPieces=function(e){this.wrongPieces=e,this.emit("model.setWrongPieces",e)},i.prototype.getWrongPieces=function(){return this.wrongPieces},i.prototype.decreaseTips=function(){0!==this.currentLevel.tips&&(this.currentLevel.tips-=1,this.paused=!0,this.emit("model.pauseGame"),this.emit("model.updateTips",this.currentLevel.tips))},i.prototype.pauseGame=function(){this.paused=!0,this.emit("model.pauseGame")},i.prototype.getCountDownTime=function(){return this.countDownTime},i.prototype.getCountDownWrongPiecesTime=function(){return this.countDownWrongPiecesTime},i.prototype.getGameLevel=function(){return this.currentLevel},i.prototype.setGameLevel=function(e){if(!this.preStarted){var t=this.settings.levels.filter(function(t){return t.ID===parseInt(e)})[0];this.currentLevel=t||this.settings.levels[0]}},i.prototype.getLevels=function(){return this.settings.levels},i.prototype.getSetting=function(e){return this.settings[e]?this.settings[e]:void 0},i.prototype.getAudioStatus=function(){return this.isAudioEnabled},i.prototype.toggleAudio=function(){this.isAudioEnabled=!this.isAudioEnabled,this.emit("model.toggleAudio",this.isAudioEnabled)},i}(window),SplashViewModel=function(e,t){"use strict";function i(e){return 0!==e.ID}function s(e,t){var i=this;this.Events=App.Utils.Events,this.DOM=App.Utils.DOM,this.model=e,this.view=t,this.methods={setGameLevel:function(e){i.model.setGameLevel(e)},preStart:function(){i.model.preStart()},closeSplashView:function(){i.view.remove()}},this.init()}return s.prototype.init=function(){var e=this.DOM.$;this.cacheDOM={startGameForm:e('[data-submit="startGame"]',this.view),triggerInput:e("#c-splash__level--0",this.view),changeGameLevel:e('[data-click="changeGameLevel"]',this.view),gameLevelLabel:e(".c-splash__label",this.view),gameLevelDesc:e("#levelDescription",this.view)},this.gameLevels=this.model.getLevels(),this.bindSplashInformation(0),this.bindSplashView(),this.bindForm(),this.cacheDOM.triggerInput.click(),this.bindEvents()},s.prototype.bindSplashView=function(){function e(e){e.stopPropagation();var i;"LABEL"===e.target.nodeName&&(i=s("#"+e.target.getAttribute("for")).value,t.methods.setGameLevel(i),t.bindSplashInformation(i))}var t=this,s=this.DOM.$,n=this.Events.$on,o=document.createDocumentFragment(),a=document.createDocumentFragment();n(this.cacheDOM.changeGameLevel,"click",e),this.gameLevels.filter(i).forEach(function(e){var i,s;i=t.cacheDOM.triggerInput.cloneNode(),i.id="c-splash__level--"+e.ID,i.value=e.ID,s=t.cacheDOM.changeGameLevel.firstElementChild.cloneNode(!0),s.firstElementChild.classList=e.icon,s.lastElementChild.setAttribute("for","c-splash__level--"+e.ID),s.lastElementChild.textContent=e.name,o.appendChild(i),a.appendChild(s)}),this.DOM.insertAfter(o,t.cacheDOM.triggerInput),this.DOM.insertAfter(a,t.cacheDOM.changeGameLevel.firstElementChild)},s.prototype.bindSplashInformation=function(e){var t=this.gameLevels[e]||this.gameLevels[0],i="";i+="Maximum time for completing: ",i+='<span class="c-splash__maxTime">'+t.time+" minuts</span>",this.cacheDOM.gameLevelDesc.innerHTML=i},s.prototype.bindEvents=function(){this.model.on("model.pre-start",this.methods.closeSplashView)},s.prototype.bindForm=function(){var e=this,t=this.Events.$on;t(this.cacheDOM.startGameForm,"submit",function(t){t.preventDefault(),e.methods.preStart()})},s}(window),InfoViewModel=function(e,t){"use strict";function i(t,i){var s=this;this.Events=App.Utils.Events,this.DOM=App.Utils.DOM,this.model=t,this.view=i,this.timer=null,this.methods={getTips:function(){s.model.decreaseTips()},restartGame:function(){e.location.reload()},closeModal:function(){s.model.isGameOver()||s.model.resumeGame(),s.DOM.$("[data-modal-restart]",s.view).remove()},showModalRestart:function(){s.model.pauseGame(),s.renderModalRestart()},toggleAudio:function(){s.model.isStarted()&&s.model.toggleAudio()}},this.init()}return i.prototype={constructor:i,init:function(){var e=this.DOM.$,t=this.DOM.$$;this.cacheDOM={toggleAudio:e('[data-click="toggleAudio"]',this.view),minutes:e("#timer #min",this.view),seconds:e("#timer #sec",this.view),clockTime:e("[data-clock]",this.view),timeLevel:e("[data-time]",this.view),pause:e(".c-timer__icon--pause",this.view),statsgameLevel:e("[data-game-level]",this.view),statsTotPieces:e("[data-total-pieces]",this.view),statsMissPieces:e("[data-missing-pieces]",this.view),statsWrngPieces:e("[data-wrong-pieces]",this.view),statsAvailTips:e("[data-available-tips]",this.view),buttons:t("[data-click]",this.view),hintsButton:e('[data-click="getTips"]',this.view),modalRestart:e("[data-modal-restart]",this.view)},this.minutesLength=this.cacheDOM.minutes.getTotalLength(),this.secondsLength=this.cacheDOM.seconds.getTotalLength(),this.audioSettings=this.model.getSetting("audio"),this.bindEvents()},showTimer:function(){this.view.parentElement.style.display="initial"},initTimer:function(){this.gameLevel=this.model.getGameLevel(),this.timer=new App.DateTime.Timer(60*this.gameLevel.time),this.cacheDOM.timeLevel.innerHTML=this.timer.getInitialTime(),this.cacheDOM.clockTime.innerHTML=this.timer.getMinutes(!0)+":"+this.timer.getSeconds(!0),this.timer.on(this.timer.ID+"-tick",this.updateClockView.bind(this)),this.timer.once(this.timer.ID+"-elapsedTime",this.gameOver.bind(this))},updateClockView:function(e,t,i,s){var n=this.gameLevel,o="",a=this.minutesLength*i/n.time,r=this.secondsLength*s/60;"00"===i&&59===s&&(console.log("ok"),this.cacheDOM.seconds.setAttribute("style","stroke: rgb(222, 6, 6);")),o+="00"===i?'<span class="c-info__span--critical">':'<span class="c-info__span--highlight">',o+=i+":"+s,o+="</span>",this.cacheDOM.clockTime.innerHTML=o,this.cacheDOM.minutes.setAttribute("stroke-dasharray",a+","+this.minutesLength),this.cacheDOM.seconds.setAttribute("stroke-dasharray",r+","+this.secondsLength)},gameOver:function(){this.model.gameOver()},setupStatistics:function(){var e=this.model.getAllPieces().length;this.cacheDOM.statsgameLevel.innerHTML=this.gameLevel.name,this.cacheDOM.statsTotPieces.innerHTML=e,this.cacheDOM.statsMissPieces.innerHTML=e,this.cacheDOM.statsWrngPieces.innerHTML="-",this.cacheDOM.statsAvailTips.innerHTML=this.gameLevel.tips},updateMissingPieces:function(e){this.cacheDOM.statsMissPieces.innerHTML=e},updateWrongPieces:function(e){this.cacheDOM.statsWrngPieces.innerHTML=e},updateTips:function(e){this.cacheDOM.statsAvailTips.innerHTML=e},disableTips:function(e){e.disabled=!0},enableTips:function(e){e.disabled=!1},pauseTimer:function(){this.timer.pause()},resumeTimer:function(){this.timer.resume()},pauseView:function(){this.pauseTimer(),this.disableTips(this.cacheDOM.hintsButton)},enableView:function(){this.resumeTimer(),this.cacheDOM.toggleAudio.classList.add("c-info__icon--hoverable"),this.gameLevel.tips>0&&this.enableTips(this.cacheDOM.hintsButton)},renderModalRestart:function(){var e="";e+='<div class="c-modal c-modal--full" data-modal-restart>',e+='  <div class="l-grid">',e+='    <div class="c-modal__header">',e+='      <i class="c-modal__closeIcon fa fa-times"',e+='         aria-hidden="true"',e+='         data-click="closeModal"></i>',e+='      <h2 class="c-modal__title">',e+="        Do you want to restart the game?",e+="      </h2>",e+="    </div>",e+='    <div class="c-modal__body">',e+='    <input class="c-info__button"',e+='           type="button"',e+='           value="Yes, restart the Game"',e+='           data-click="restartGame">',e+="    </div>",e+="</div>",this.view.insertAdjacentHTML("beforeend",e)},renderModalGameOver:function(){var e="";e+='<div class="c-modal c-modal--full c-modal--interaction">',e+='  <div class="l-grid l-grid--transparent">',e+='    <div class="c-modal__header">',e+='      <h2 class="c-modal__title c-modal__title--zoomIN">',e+="        GAME OVER",e+="      </h2>",e+="    </div>",e+="</div>",this.view.insertAdjacentHTML("beforeend",e)},renderModalWinner:function(){var e="";e+='<div class="c-modal c-modal--full c-modal--interaction">',e+='  <div class="l-grid l-grid--transparent">',e+='    <div class="c-modal__header">',e+='      <h2 class="c-modal__title c-modal__title--zoomIN">',e+="        Congratulations! You Win",e+='        <i class="c-info__icon',e+='                  c-info__icon--winner fa fa-trophy"',e+='            aria-hidden="true"></i>',e+="      </h2>",e+="    </div>",e+="</div>",this.view.insertAdjacentHTML("beforeend",e)},renderModalWrongSequence:function(){var e=this,t=this.model.getCountDownWrongPiecesTime(),i=new App.DateTime.Timer(t),s="";s+='<div class="c-modal c-modal--full c-modal--interaction" id="t'+i.ID+'">',s+='  <div class="l-grid l-grid--transparent">',s+='    <div class="c-modal__header">',s+='      <h2 class="c-modal__title c-modal__title--flash">',s+="        Wrong sequence. Please check your pieces",s+="      </h2>",s+='      <i class="c-info__icon',s+='                c-info__icon--exclamation fa fa-exclamation-triangle"',s+='          aria-hidden="true"></i>',s+="    </div>",s+="</div>",this.view.insertAdjacentHTML("beforeend",s),i.start(),i.on(i.ID+"-elapsedTime",function(){e.DOM.$("#t"+i.ID).remove()})},loadClappingAudio:function(){var e=document.createElement("AUDIO"),t=this.audioSettings.clapping;e.setAttribute("src",t),e.autoplay=!0,this.view.appendChild(e)},loadGameOverAudio:function(){var e=document.createElement("AUDIO"),t=this.audioSettings.fail;e.setAttribute("src",t),e.autoplay=!0,this.view.appendChild(e)},toggleAudioButton:function(e){var t=e?"on":"off",i=e?"off":"on",s=e?"Disable":"Enable",n="fa-volume";this.cacheDOM.toggleAudio.classList.remove(n+"-"+i),this.cacheDOM.toggleAudio.classList.add(n+"-"+t),this.cacheDOM.toggleAudio.setAttribute("title",s+" audio")},bindEvents:function(){function e(){s.showTimer(),s.initTimer()}function t(){s.pauseView(),s.renderModalWinner(),s.loadClappingAudio()}function i(){s.pauseView(),s.renderModalGameOver(),s.loadGameOverAudio()}var s=this;this.view.addEventListener("click",function(e){e.stopPropagation();var t=e.target.getAttribute("data-click");t&&s.methods[t]&&"function"==typeof s.methods[t]&&s.methods[t](e)}),this.model.on("model.pre-start",e),this.model.on("model.pre-start",this.setupStatistics.bind(this)),this.model.on("model.start",this.enableView.bind(this)),this.model.on("model.decreaseMissingPieces",this.updateMissingPieces.bind(this)),this.model.on("model.increaseMissingPieces",this.updateMissingPieces.bind(this)),this.model.on("model.setWrongPieces",this.updateWrongPieces.bind(this)),this.model.on("model.updateTips",this.updateTips.bind(this)),this.model.on("model.pauseGame",this.pauseView.bind(this)),this.model.on("model.resumeGame",this.enableView.bind(this)),this.model.on("model.wrongSequence",this.renderModalWrongSequence.bind(this)),this.model.on("model.toggleAudio",this.toggleAudioButton.bind(this)),this.model.on("model.gameOver",i),this.model.on("model.winnerUSER",t)}},i}(window),PuzzleViewModel=function(e,t){"use strict";function i(e,t){this.Events=App.Utils.Events,this.DOM=App.Utils.DOM,this.model=e,this.view=t,this.methods={},this.init()}return i.prototype={constructor:i,init:function(){var e=this.DOM.$,t=this.DOM.$$;this.cacheDOM={puzzleView:e(".c-puzzle",this.view),countDown:e(".c-countDown",this.view),countDownNumber:e("[data-counter]",this.view),piecesDesk:e(".c-pieces",this.view),pieces:t(".c-pieces__piece",this.view),hexagons:t(".c-puzzle__hexagon",this.view),unsolvedImg:e(".c-puzzle__img--unsolved",this.view)},this.audioSettings=this.model.getSetting("audio"),this.loadBackgroundSounds(),this.bindEvents()},removePieces:function(){this.cacheDOM.pieces.forEach(function(e){e.remove(),e.classList.remove("c-pieces__piece--falling")})},shuffleAndAddPieces:function(){var e=this.model.getAllPieces(),t=App.Utils.Array.shuffle(e),i=document.createDocumentFragment();t.forEach(function(e){var t=document.createElement("IMG");t.classList.add("c-pieces__piece"),t.classList.add("c-pieces__piece--fromBottom"),t.setAttribute("ID",e),t.setAttribute("data-piece",e),t.setAttribute("src","assets/img/piece_"+e+".png"),t.setAttribute("draggable",!0),t.setAttribute("alt","Puzzle's piece number"+e),i.appendChild(t)}),this.cacheDOM.piecesDesk.classList.add("c-pieces--dashed"),this.cacheDOM.piecesDesk.appendChild(i)},showPuzzle:function(){this.view.style.display="initial"},loadBackgroundSounds:function(){var e=document.createElement("AUDIO"),t=document.createElement("AUDIO"),i=this.audioSettings.background,s=this.audioSettings.swap;e.setAttribute("src",i),e.setAttribute("preload","auto"),e.volume=.3,e.loop=!0,t.setAttribute("src",s),t.setAttribute("preload","auto"),t.volume=1,this.cacheDOM.backgroundAudio=e,this.cacheDOM.swapAudio=t,this.view.appendChild(e),this.view.appendChild(t)},fallingDown:function(){var e=App.Utils.Array.toArr(this.cacheDOM.pieces),t=document.createElement("AUDIO"),i=this.audioSettings.broken;t.setAttribute("src",i),t.autoplay=!0,t.volume=.5,this.view.appendChild(t),t.load(),e.forEach(function(e){e.classList.add("c-pieces__piece--falling")}),this.removeCountDown()},initCountDown:function(){var e=this.model.getCountDownTime();this.countDownTimer=new App.DateTime.Timer(e);var t=document.createElement("AUDIO"),i=this.audioSettings.countDown;t.setAttribute("src",i),t.autoplay=!0,this.view.appendChild(t),this.countDownTimer.on(this.countDownTimer.ID+"-tick",this.updateCountDown.bind(this)),this.countDownTimer.on(this.countDownTimer.ID+"-elapsedTime",this.fallingDown.bind(this))},updateCountDown:function(){var e=this.cacheDOM.countDownNumber,t=e.cloneNode();t.textContent=this.countDownTimer.getSeconds(),this.DOM.insertAfter(t,e)},removeCountDown:function(){this.cacheDOM.countDown.remove()},handleDrag:function(){var e=this.cacheDOM.puzzleView,t=this.cacheDOM.piecesDesk;e.addEventListener("dragstart",this._handleDrag),t.addEventListener("dragstart",this._handleDrag)},disableDrag:function(){var e=this.cacheDOM.puzzleView,t=this.cacheDOM.piecesDesk;e.removeEventListener("dragstart",this._handleDrag),t.removeEventListener("dragstart",this._handleDrag)},handleDrop:function(){var e=this.cacheDOM.puzzleView,t=this.cacheDOM.piecesDesk;e.addEventListener("dragover",this._allowDrop),t.addEventListener("dragover",this._allowDrop),e.addEventListener("drop",this._handlePuzzleDrop.bind(this)),t.addEventListener("drop",this._handleDeskDrop.bind(this))},disableDrop:function(){var e=this.cacheDOM.puzzleView,t=this.cacheDOM.piecesDesk;e.removeEventListener("dragover",this._allowDrop),t.removeEventListener("dragover",this._allowDrop),e.removeEventListener("drop",this._handlePuzzleDrop.bind(this)),t.removeEventListener("drop",this._handleDeskDrop.bind(this))},toggleAudio:function(e){e?this.playBackgroundSound():this.pauseBackgroundSound()},_handleDrag:function(e){e.target.classList.contains("c-pieces__piece")&&e.dataTransfer.setData("Text",e.target.id)},_handlePuzzleDrop:function(e){e.preventDefault();var t,i,s,n=e.target;(n.classList.contains("c-puzzle__hexagon")||n.classList.contains("c-pieces__piece"))&&(t=e.dataTransfer.getData("text"),i=App.Utils.DOM.id(t),s=n.nodeName,this.cacheDOM.swapAudio.play(),"IMG"===s?(i.classList.contains("c-pieces__piece--fromBottom")&&(n.classList.add("c-pieces__piece--fromBottom"),i.classList.remove("c-pieces__piece--fromBottom")),App.Utils.DOM.swapElements(n,i)):n.appendChild(i),i.classList.contains("c-pieces__piece--fromBottom")&&(i.classList.remove("c-pieces__piece--fromBottom"),this.model.decreaseMissingPieces()),this._estimateWrongPieces())},_handleDeskDrop:function(e){e.preventDefault();var t=e.dataTransfer.getData("text"),i=App.Utils.DOM.id(t);e.target.classList.contains("c-pieces__piece")?e.target.parentNode.insertBefore(i,e.target):e.target.appendChild(i),i.classList.contains("c-pieces__piece--fromBottom")||(i.classList.add("c-pieces__piece--fromBottom"),this.model.increaseMissingPieces()),this._estimateWrongPieces(),this.cacheDOM.swapAudio.play()},enablePuzzleImg:function(){this.cacheDOM.unsolvedImg.classList.remove("c-puzzle__img--disabled")},disablePuzzleImg:function(){this.cacheDOM.unsolvedImg.classList.add("c-puzzle__img--disabled")},pauseBackgroundSound:function(){this.cacheDOM.backgroundAudio.pause()},playBackgroundSound:function(){this.cacheDOM.backgroundAudio.play()},_allowDrop:function(e){e.preventDefault()},_estimateWrongPieces:function(){var e,t=App.Utils.Array.toArr(this.cacheDOM.hexagons);e=t.filter(function(e){return e.children.length>0}).filter(function(e){var t=e.firstElementChild;return e.getAttribute("data-piece")!==t.getAttribute("data-piece")}),this.model.setWrongPieces(e.length)},showTip:function(){var e=this,t=e.model.getTipsTime(),i=new App.DateTime.Timer(t),s=document.createElement("IMG");s.classList.add("c-puzzle__img"),s.classList.add("c-puzzle__img--solved"),s.setAttribute("src","assets/img/puzzle_solved.png"),s.setAttribute("alt","Solved Puzzle"),this.cacheDOM.puzzleView.appendChild(s),i.start(),i.on(i.ID+"-elapsedTime",function(){s.remove(),e.model.resumeGame()})},bindEvents:function(){function e(){n.gameLevel=n.model.getGameLevel(),n.initCountDown(),n.showPuzzle(),n.countDownTimer.start()}function t(){n.removePieces(),n.shuffleAndAddPieces(),n.model.start(),n.playBackgroundSound()}function i(){n.handleDrag(),n.handleDrop(),n.playBackgroundSound(),n.enablePuzzleImg()}function s(){n.disableDrag(),n.disableDrop(),n.pauseBackgroundSound(),n.disablePuzzleImg()}var n=this;App.Utils.Events.$prefixedOn(this.cacheDOM.pieces[0],"animationend",t),this.model.on("model.pre-start",e),this.model.on("model.start",i),this.model.on("model.updateTips",this.showTip.bind(this)),this.model.on("model.toggleAudio",this.toggleAudio.bind(this)),this.model.on("model.pauseGame",s),this.model.on("model.resumeGame",i),this.model.on("model.winnerUSER",this.pauseBackgroundSound.bind(this)),this.model.on("model.gameOver",s)}},i}(window);