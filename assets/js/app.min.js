var App={namespace:function(name){for(var parts=name.split("."),ns=this,i=0,len=parts.length;i<len;i++)ns[parts[i]]=ns[parts[i]]||{},ns=ns[parts[i]];return ns}};App.namespace("Utils").DOM=function(){var $=function(selector,context){return(context||document).querySelector(selector)},$$=function(selector,context){return(context||document).querySelectorAll(selector)},id=function(selector,context){return(context||document).getElementById(selector)},removeAll=function(nodeList){return nodeList=nodeList||[],nodeList.forEach(function(element){element.parentNode.removeChild(element)}),[].slice.call(nodeList)},removeAllBySelector=function(selector){return removeAll($$(selector))},swapElements=function(nodeA,nodeB){var parentA=nodeA.parentNode,parentB=nodeB.parentNode,success=null;try{parentA.replaceChild(nodeB.cloneNode(!0),nodeA),parentB.replaceChild(nodeA.cloneNode(!0),nodeB),success=!0}catch(e){success=!1}return success},insertAfter=function(newNode,refNode){return refNode.parentNode.insertBefore(newNode,refNode.nextSibling)},innerH=function(target,value){target.innerHTML=value};return{$:$,$$:$$,id:id,removeAll:removeAll,removeAllBySelector:removeAllBySelector,swapElements:swapElements,insertAfter:insertAfter,innerH:innerH}}(),App.namespace("Utils").Math=function(){var getRandom=function(max){return parseInt(Math.random()*max,10)};return{getRandom:getRandom}}(),App.namespace("Utils").Array=function(){var _math=App.Utils.Math,indexOf=function(haystack,needle){var i=0,length=haystack.length,found=!1,idx=-1;if("function"==typeof Array.prototype.indexOf)return haystack.indexOf(needle);for(;i<length&&!found;)haystack[i]===needle&&(idx=i,found=!0),i++;return idx},shuffle=function(array){for(var rnd,result=[],len=array.length;len;)rnd=_math.getRandom(array.length),rnd in array&&(result.push(array[rnd]),delete array[rnd],len--);return result},toArr=function(list){return[].slice.call(list)};return{indexOf:indexOf,shuffle:shuffle,toArr:toArr}}(),App.namespace("Utils").Obj=function(){function s4(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var isOfType=function(el,type){var objType;return type=(type||"").trim().toLowerCase(),objType=Object.prototype.toString.call(el).toLowerCase(),objType==="[object "+type+"]"},extend=function(){var extended={},deep=!1,i=0,length=arguments.length;isOfType(arguments[0],"Boolean")&&(deep=arguments[0],i++);for(var merge=function(obj){for(var prop in obj)Object.prototype.hasOwnProperty.call(obj,prop)&&(deep&&isOfType(obj[prop],"Object")?extended[prop]=extend(!0,extended[prop],obj[prop]):extended[prop]=obj[prop])};i<length;i++){var obj=arguments[i];merge(obj)}return extended},guid=function(){return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()};return{extend:extend,guid:guid}}(),App.namespace("Utils").Events=function(){var EventEmitter=function(){this.events={}};EventEmitter.prototype.on=function(event,listener){"object"!=typeof this.events[event]&&(this.events[event]=[]),this.events[event].push(listener)},EventEmitter.prototype.removeListener=function(event,listener){var idx;"object"==typeof this.events[event]&&(idx=App.Utils.Array.indexOf(this.events[event],listener),idx>-1&&this.events[event].splice(idx,1))},EventEmitter.prototype.emit=function(event){var i,listeners,length,args=[].slice.call(arguments,1);if("object"==typeof this.events[event])for(listeners=this.events[event].slice(),length=listeners.length,i=0;i<length;i++)listeners[i].apply(this,args)},EventEmitter.prototype.once=function(event,listener){this.on(event,function g(){this.removeListener(event,g),listener.apply(this,arguments)})};var $on=function(target,type,callback,useCapture){target.addEventListener(type,callback,!!useCapture)},pfx=["webkit","moz","MS","o",""],$prefixedOn=function(target,type,callback,useCapture){for(var p=0,length=pfx.length;p<length;p++)pfx[p]||(type=type.toLowerCase()),target.addEventListener(pfx[p]+type,callback,!!useCapture)};return{Emitter:EventEmitter,$on:$on,$prefixedOn:$prefixedOn}}(),App.namespace("DateTime").Timer=function(window){function Timer(time,step){this.isStarted=!1,this.paused=!0,this.timerId=null,this.time=Math.floor(time),this.ID=App.Utils.Obj.guid(),this.step=step||1,this.initialTime=this.getCurrentTime()}return Timer.prototype=new App.Utils.Events.Emitter,Timer.prototype.constructor=Timer,Timer.prototype.getHours=function(){return Math.floor(this.time/3600)},Timer.prototype.getMinutes=function(doubleZero){var h=this.getHours(),m=Math.floor((this.time-3600*h)/60);return doubleZero&&m<10&&(m="0"+m),m},Timer.prototype.getSeconds=function(doubleZero){var h=this.getHours(),m=this.getMinutes(!0),s=this.time-3600*h-60*m;return doubleZero&&s<10&&(s="0"+s),s},Timer.prototype.getCurrentTime=function(){var h=this.getHours(),m=this.getMinutes(!0),s=this.getSeconds(!0);return h+":"+m+":"+s},Timer.prototype.getInitialTime=function(){return this.initialTime},Timer.prototype.setTime=function(time,step){this.isStarted&&(this.time=Math.floor(time),this.step=step||1)},Timer.prototype.count=function(){var h=this.getHours(),m=this.getMinutes(!0),s=this.getSeconds(!0),c=this.getCurrentTime();this.emit(this.ID+"-tick",c,h,m,s),this.time-=this.step,this.time<0&&(window.clearInterval(this.timerId),this.emit(this.ID+"-elapsedTime"))},Timer.prototype.start=function(){this.isStarted=!0,this.resume()},Timer.prototype.resume=function(){var self=this;this.paused&&this.time>0&&(this.timerId=window.setInterval(self.count.bind(self),1e3*self.step),this.paused=!1)},Timer.prototype.pause=function(){this.paused=!0,window.clearInterval(this.timerId)},Timer.prototype.isPaused=function(){return this.paused},Timer}(window);var PuzzleModel=function(window,undefined){"use strict";function PuzzleModel(){this.started=!1,this.paused=!1,this.isOver=!1,this.pieces=[[45],[41],[37],[33],[29],[43],[39],[35],[31],[44],[40],[36],[32],[28],[42],[38],[34],[30],[27],[18],[14],[10],[6],[25],[16],[12],[8],[26],[17],[13],[9],[5],[24],[15],[11],[7],[23],[22],[21],[20],[19]],this.partial=[],this.settings={audio:{background:"assets/sounds/magic_clock.mp3",swap:"assets/sounds/swap_sound.mp3",broken:"assets/sounds/broken_glass.mp3",countDown:"assets/sounds/countdown.mp3",clapping:"assets/sounds/clapping.mp3",fail:"assets/sounds/fail_effect.mp3"},levels:[{ID:0,name:"easy",time:7,icon:"fa fa-star-o",tips:3},{ID:1,name:"medium",time:5,icon:"fa fa-star-half-o",tips:2},{ID:2,name:"hard",time:3,icon:"fa fa-star",tips:1}]},this.currentLevel=this.settings.levels[0],this.countDownTime=5,this.countDownWrongPiecesTime=1.5,this.missingPieces=this.pieces.length,this.wrongPieces=0,this.tipsTime=5}return PuzzleModel.prototype=new App.Utils.Events.Emitter,PuzzleModel.prototype.constructor=PuzzleModel,PuzzleModel.prototype.preStart=function(){this.isStarted()||(this.started=!0,this.emit("model.pre-start"))},PuzzleModel.prototype.start=function(){this.emit("model.start")},PuzzleModel.prototype.gameOver=function(){this.isOver=!0,this.emit("model.gameOver")},PuzzleModel.prototype.isGameOver=function(){return this.isOver},PuzzleModel.prototype.getTipsTime=function(){return this.tipsTime},PuzzleModel.prototype.isStarted=function(){return this.started},PuzzleModel.prototype.pauseGame=function(){this.paused=!0,this.emit("model.pauseGame")},PuzzleModel.prototype.resumeGame=function(){this.paused=!1,this.emit("model.resumeGame")},PuzzleModel.prototype.getAllPieces=function(){return this.pieces},PuzzleModel.prototype.getMissingPieces=function(){return this.missingPieces},PuzzleModel.prototype.decreaseMissingPieces=function(){this.missingPieces-=1,this.emit("model.decreaseMissingPieces",this.missingPieces),0===this.missingPieces&&0===this.wrongPieces&&this.emit("model.winnerUSER",this.missingPieces),0===this.missingPieces&&0!==this.wrongPieces&&this.emit("model.wrongSequence")},PuzzleModel.prototype.increaseMissingPieces=function(){this.missingPieces+=1,this.emit("model.increaseMissingPieces",this.missingPieces)},PuzzleModel.prototype.setWrongPieces=function(value){this.wrongPieces=value,this.emit("model.setWrongPieces",value)},PuzzleModel.prototype.getWrongPieces=function(){return this.wrongPieces},PuzzleModel.prototype.decreaseTips=function(){0!==this.currentLevel.tips&&(this.currentLevel.tips-=1,this.paused=!0,this.emit("model.pauseGame"),this.emit("model.updateTips",this.currentLevel.tips))},PuzzleModel.prototype.pauseGame=function(){this.paused=!0,this.emit("model.pauseGame")},PuzzleModel.prototype.getCountDownTime=function(){return this.countDownTime},PuzzleModel.prototype.getCountDownWrongPiecesTime=function(){return this.countDownWrongPiecesTime},PuzzleModel.prototype.getGameLevel=function(){return this.currentLevel},PuzzleModel.prototype.setGameLevel=function(currentLevel){if(!this.isStarted()){var choosenLevel=this.settings.levels.filter(function(level){return level.ID===parseInt(currentLevel)})[0];this.currentLevel=choosenLevel||this.settings.levels[0]}},PuzzleModel.prototype.getLevels=function(){return this.settings.levels},PuzzleModel.prototype.getSetting=function(name){return this.settings[name]?this.settings[name]:void 0},PuzzleModel}(window),SplashViewModel=function(window,undefined){"use strict";function excludeDefault(level){return 0!==level.ID}function SplashViewModel(model,splashView){var self=this;this.Events=App.Utils.Events,this.DOM=App.Utils.DOM,this.model=model,this.view=splashView,this.methods={setGameLevel:function(level){self.model.setGameLevel(level)},preStart:function(){self.model.preStart()},closeSplashView:function(){self.view.remove()}},this.init()}return SplashViewModel.prototype.init=function(){var $=this.DOM.$;this.cacheDOM={startGameForm:$('[data-submit="startGame"]',this.view),triggerInput:$("#c-splash__level--0",this.view),changeGameLevel:$('[data-click="changeGameLevel"]',this.view),gameLevelLabel:$(".c-splash__label",this.view),gameLevelDesc:$("#levelDescription",this.view)},this.gameLevels=this.model.getLevels(),this.bindSplashInformation(0),this.bindSplashView(),this.bindForm(),this.cacheDOM.triggerInput.click(),this.bindEvents()},SplashViewModel.prototype.bindSplashView=function(){function setLevel(event){event.stopPropagation();var id;"LABEL"===event.target.nodeName&&(id=$("#"+event.target.getAttribute("for")).value,self.methods.setGameLevel(id),self.bindSplashInformation(id))}var self=this,$=this.DOM.$,$on=this.Events.$on,inputsFragment=document.createDocumentFragment(),itemsFragment=document.createDocumentFragment();$on(this.cacheDOM.changeGameLevel,"click",setLevel),this.gameLevels.filter(excludeDefault).forEach(function(level){var newTriggerInput,newItem;newTriggerInput=self.cacheDOM.triggerInput.cloneNode(),newTriggerInput.id="c-splash__level--"+level.ID,newTriggerInput.value=level.ID,newItem=self.cacheDOM.changeGameLevel.firstElementChild.cloneNode(!0),newItem.firstElementChild.classList=level.icon,newItem.lastElementChild.setAttribute("for","c-splash__level--"+level.ID),newItem.lastElementChild.textContent=level.name,inputsFragment.appendChild(newTriggerInput),itemsFragment.appendChild(newItem)}),this.DOM.insertAfter(inputsFragment,self.cacheDOM.triggerInput),this.DOM.insertAfter(itemsFragment,self.cacheDOM.changeGameLevel.firstElementChild)},SplashViewModel.prototype.bindSplashInformation=function(id){var level=this.gameLevels[id]||this.gameLevels[0],desc="";desc+="Maximum time for completing: ",desc+='<span class="c-splash__maxTime">'+level.time+" minuts</span>",this.cacheDOM.gameLevelDesc.innerHTML=desc},SplashViewModel.prototype.bindEvents=function(){this.model.on("model.pre-start",this.methods.closeSplashView)},SplashViewModel.prototype.bindForm=function(){var self=this,$on=this.Events.$on;$on(this.cacheDOM.startGameForm,"submit",function(event){event.preventDefault(),self.methods.preStart()})},SplashViewModel}(window),InfoViewModel=function(window,undefined){"use strict";function InfoViewModel(model,infoView){var self=this;this.Events=App.Utils.Events,this.DOM=App.Utils.DOM,this.model=model,this.view=infoView,this.timer=null,this.methods={getTips:function(){self.model.decreaseTips()},restartGame:function(){window.location.reload()},closeModal:function(){self.model.isGameOver()||self.model.resumeGame(),self.DOM.$("[data-modal-restart]",self.view).remove()},showModalRestart:function(){self.model.pauseGame(),self.renderModalRestart()}},this.init()}return InfoViewModel.prototype={constructor:InfoViewModel,init:function(){var $=this.DOM.$,$$=this.DOM.$$;this.cacheDOM={playPauseButton:$(".c-timer__icon--pause",this.view),minutes:$("#timer #min",this.view),seconds:$("#timer #sec",this.view),clockTime:$("[data-clock]",this.view),timeLevel:$("[data-time]",this.view),pause:$(".c-timer__icon--pause",this.view),statsgameLevel:$("[data-game-level]",this.view),statsTotPieces:$("[data-total-pieces]",this.view),statsMissPieces:$("[data-missing-pieces]",this.view),statsWrngPieces:$("[data-wrong-pieces]",this.view),statsAvailTips:$("[data-available-tips]",this.view),buttons:$$("[data-click]",this.view),hintsButton:$('[data-click="getTips"]',this.view),modalRestart:$("[data-modal-restart]",this.view)},this.minutesLength=this.cacheDOM.minutes.getTotalLength(),this.secondsLength=this.cacheDOM.seconds.getTotalLength(),this.audioSettings=this.model.getSetting("audio"),this.bindEvents()},showTimer:function(){this.view.parentElement.style.display="initial"},initTimer:function(){this.gameLevel=this.model.getGameLevel(),this.timer=new App.DateTime.Timer(60*this.gameLevel.time),this.cacheDOM.timeLevel.innerHTML=this.timer.getInitialTime(),this.cacheDOM.clockTime.innerHTML=this.timer.getMinutes(!0)+":"+this.timer.getSeconds(!0),this.timer.on(this.timer.ID+"-tick",this.updateClockView.bind(this)),this.timer.once(this.timer.ID+"-elapsedTime",this.gameOver.bind(this))},updateClockView:function(currentTime,hour,minutes,seconds){var gameLevel=this.gameLevel,time="",newMin=this.minutesLength*minutes/gameLevel.time,newSec=this.secondsLength*seconds/60;time+="00"===minutes?'<span class="c-info__span--critical">':'<span class="c-info__span--highlight">',time+=minutes+":"+seconds,time+="</span>",this.cacheDOM.clockTime.innerHTML=time,this.cacheDOM.minutes.setAttribute("stroke-dasharray",newMin+","+this.minutesLength),this.cacheDOM.seconds.setAttribute("stroke-dasharray",newSec+","+this.secondsLength)},gameOver:function(){this.model.gameOver()},setupStatistics:function(){var totPieces=this.model.getAllPieces().length;this.cacheDOM.statsgameLevel.innerHTML=this.gameLevel.name,this.cacheDOM.statsTotPieces.innerHTML=totPieces,this.cacheDOM.statsMissPieces.innerHTML=totPieces,this.cacheDOM.statsWrngPieces.innerHTML="-",this.cacheDOM.statsAvailTips.innerHTML=this.gameLevel.tips},updateMissingPieces:function(value){this.cacheDOM.statsMissPieces.innerHTML=value},updateWrongPieces:function(value){this.cacheDOM.statsWrngPieces.innerHTML=value},updateTips:function(value){this.cacheDOM.statsAvailTips.innerHTML=value},disableTips:function(target){target.disabled=!0},enableTips:function(target){target.disabled=!1},pauseTimer:function(){this.timer.pause()},resumeTimer:function(){this.timer.resume()},pauseView:function(){this.pauseTimer(),this.disableTips(this.cacheDOM.hintsButton)},enableView:function(){this.resumeTimer(),this.gameLevel.tips>0&&this.enableTips(this.cacheDOM.hintsButton)},renderModalRestart:function(){var html="";html+='<div class="c-modal c-modal--full" data-modal-restart>',html+='  <div class="l-grid">',html+='    <div class="c-modal__header">',html+='      <i class="c-modal__closeIcon fa fa-times"',html+='         aria-hidden="true"',html+='         data-click="closeModal"></i>',html+='      <h2 class="c-modal__title">',html+="        Do you want to restart the game?",html+="      </h2>",html+="    </div>",html+='    <div class="c-modal__body">',html+='    <input class="c-info__button"',html+='           type="button"',html+='           value="Yes, restart the Game"',html+='           data-click="restartGame">',html+="    </div>",html+="</div>",this.view.insertAdjacentHTML("beforeend",html)},renderModalGameOver:function(){var html="";html+='<div class="c-modal c-modal--full c-modal--interaction">',html+='  <div class="l-grid l-grid--transparent">',html+='    <div class="c-modal__header">',html+='      <h2 class="c-modal__title c-modal__title--zoomIN">',html+="        GAME OVER",html+="      </h2>",html+="    </div>",html+="</div>",this.view.insertAdjacentHTML("beforeend",html)},renderModalWinner:function(){var html="";html+='<div class="c-modal c-modal--full c-modal--interaction">',html+='  <div class="l-grid l-grid--transparent">',html+='    <div class="c-modal__header">',html+='      <h2 class="c-modal__title c-modal__title--zoomIN">',html+="        Congratulations! You Win",html+='        <i class="c-info__icon',html+='                  c-info__icon--winner fa fa-trophy"',html+='            aria-hidden="true"></i>',html+="      </h2>",html+="    </div>",html+="</div>",this.view.insertAdjacentHTML("beforeend",html)},renderModalWrongSequence:function(){var self=this,time=this.model.getCountDownWrongPiecesTime(),timer=new App.DateTime.Timer(time),html="";html+='<div class="c-modal c-modal--full c-modal--interaction" id="t'+timer.ID+'">',html+='  <div class="l-grid l-grid--transparent">',html+='    <div class="c-modal__header">',html+='      <h2 class="c-modal__title c-modal__title--flash">',html+="        Wrong sequence. Please check your pieces",html+="      </h2>",html+='      <i class="c-info__icon',html+='                c-info__icon--exclamation fa fa-exclamation-triangle"',html+='          aria-hidden="true"></i>',html+="    </div>",html+="</div>",this.view.insertAdjacentHTML("beforeend",html),timer.start(),timer.on(timer.ID+"-elapsedTime",function(){self.DOM.$("#t"+timer.ID).remove()})},loadClappingAudio:function(){var audio=document.createElement("AUDIO"),clappingSrc=this.audioSettings.clapping;audio.setAttribute("src",clappingSrc),audio.autoplay=!0,this.view.appendChild(audio)},loadGameOverAudio:function(){var audio=document.createElement("AUDIO"),failSrc=this.audioSettings.fail;audio.setAttribute("src",failSrc),audio.autoplay=!0,this.view.appendChild(audio)},bindEvents:function(){function setupTimer(){self.showTimer(),self.initTimer()}function winnerAction(){self.pauseView(),self.renderModalWinner(),self.loadClappingAudio()}function gameOverAction(){self.pauseView(),self.renderModalGameOver(),self.loadGameOverAudio()}var self=this;this.view.addEventListener("click",function(event){event.stopPropagation();var methodName=event.target.getAttribute("data-click");methodName&&self.methods[methodName]&&"function"==typeof self.methods[methodName]&&self.methods[methodName](event)}),this.model.on("model.pre-start",setupTimer),this.model.on("model.pre-start",this.setupStatistics.bind(this)),this.model.on("model.start",this.enableView.bind(this)),this.model.on("model.decreaseMissingPieces",this.updateMissingPieces.bind(this)),this.model.on("model.increaseMissingPieces",this.updateMissingPieces.bind(this)),this.model.on("model.setWrongPieces",this.updateWrongPieces.bind(this)),this.model.on("model.updateTips",this.updateTips.bind(this)),this.model.on("model.pauseGame",this.pauseView.bind(this)),this.model.on("model.resumeGame",this.enableView.bind(this)),this.model.on("model.wrongSequence",this.renderModalWrongSequence.bind(this)),this.model.on("model.gameOver",gameOverAction),this.model.on("model.winnerUSER",winnerAction)}},InfoViewModel}(window),PuzzleViewModel=function(window,undefined){"use strict";function PuzzleViewModel(model,puzzleView){this.Events=App.Utils.Events,this.DOM=App.Utils.DOM,this.model=model,this.view=puzzleView,this.methods={},this.init()}return PuzzleViewModel.prototype={constructor:PuzzleViewModel,init:function(){var $=this.DOM.$,$$=this.DOM.$$;this.cacheDOM={puzzleView:$(".c-puzzle",this.view),countDown:$(".c-countDown",this.view),countDownNumber:$("[data-counter]",this.view),piecesDesk:$(".c-pieces",this.view),pieces:$$(".c-pieces__piece",this.view),hexagons:$$(".c-puzzle__hexagon",this.view),unsolvedImg:$(".c-puzzle__img--unsolved",this.view)},this.audioSettings=this.model.getSetting("audio"),this.loadBackgroundSounds(),this.bindEvents()},removePieces:function(){this.cacheDOM.pieces.forEach(function(piece){piece.remove(),piece.classList.remove("c-pieces__piece--falling")})},shuffleAndAddPieces:function(){var list=this.model.getAllPieces(),shuffled=App.Utils.Array.shuffle(list),fragment=document.createDocumentFragment();shuffled.forEach(function(piece){var image=document.createElement("IMG");image.classList.add("c-pieces__piece"),image.classList.add("c-pieces__piece--fromBottom"),image.setAttribute("ID",piece),image.setAttribute("data-piece",piece),image.setAttribute("src","assets/img/piece_"+piece+".png"),image.setAttribute("draggable",!0),image.setAttribute("alt","Puzzle's piece number"+piece),fragment.append(image)}),this.cacheDOM.piecesDesk.classList.add("c-pieces--dashed"),this.cacheDOM.piecesDesk.append(fragment)},showPuzzle:function(){this.view.style.display="initial"},loadBackgroundSounds:function(){var backgroundAudio=document.createElement("AUDIO"),swapAudio=document.createElement("AUDIO"),backgrondSrc=this.audioSettings.background,swapSrc=this.audioSettings.swap;backgroundAudio.setAttribute("src",backgrondSrc),backgroundAudio.setAttribute("preload","auto"),backgroundAudio.volume=.3,backgroundAudio.loop=!0,swapAudio.setAttribute("src",swapSrc),swapAudio.setAttribute("preload","auto"),swapAudio.volume=1,this.cacheDOM.backgroundAudio=backgroundAudio,this.cacheDOM.swapAudio=swapAudio,this.view.appendChild(backgroundAudio),this.view.appendChild(swapAudio)},fallingDown:function(){var list=App.Utils.Array.toArr(this.cacheDOM.pieces),audio=document.createElement("AUDIO"),brokenSrc=this.audioSettings.broken;audio.setAttribute("src",brokenSrc),audio.autoplay=!0,audio.volume=.5,this.view.appendChild(audio),audio.load(),list.forEach(function(piece){piece.classList.add("c-pieces__piece--falling")}),this.removeCountDown()},initCountDown:function(){var countDownTime=this.model.getCountDownTime();this.countDownTimer=new App.DateTime.Timer(countDownTime);var audio=document.createElement("AUDIO"),countDownSrc=this.audioSettings.countDown;audio.setAttribute("src",countDownSrc),audio.autoplay=!0,this.view.appendChild(audio),this.countDownTimer.on(this.countDownTimer.ID+"-tick",this.updateCountDown.bind(this)),this.countDownTimer.on(this.countDownTimer.ID+"-elapsedTime",this.fallingDown.bind(this))},updateCountDown:function(){var countDownNumber=this.cacheDOM.countDownNumber,newNumber=countDownNumber.cloneNode();newNumber.textContent=this.countDownTimer.getSeconds(),this.DOM.insertAfter(newNumber,countDownNumber)},removeCountDown:function(){this.cacheDOM.countDown.remove()},handleDrag:function(){var puzzleView=this.cacheDOM.puzzleView,deskView=this.cacheDOM.piecesDesk;puzzleView.addEventListener("dragstart",this._handleDrag),deskView.addEventListener("dragstart",this._handleDrag)},disableDrag:function(){var puzzleView=this.cacheDOM.puzzleView,deskView=this.cacheDOM.piecesDesk;puzzleView.removeEventListener("dragstart",this._handleDrag),deskView.removeEventListener("dragstart",this._handleDrag)},handleDrop:function(){var puzzleView=this.cacheDOM.puzzleView,deskView=this.cacheDOM.piecesDesk;puzzleView.addEventListener("dragover",this._allowDrop),deskView.addEventListener("dragover",this._allowDrop),puzzleView.addEventListener("drop",this._handlePuzzleDrop.bind(this)),deskView.addEventListener("drop",this._handleDeskDrop.bind(this))},disableDrop:function(){var puzzleView=this.cacheDOM.puzzleView,deskView=this.cacheDOM.piecesDesk;puzzleView.removeEventListener("dragover",this._allowDrop),deskView.removeEventListener("dragover",this._allowDrop),puzzleView.removeEventListener("drop",this._handlePuzzleDrop.bind(this)),deskView.removeEventListener("drop",this._handleDeskDrop.bind(this))},_handleDrag:function(event){event.target.classList.contains("c-pieces__piece")&&event.dataTransfer.setData("Text",event.target.id)},_handlePuzzleDrop:function(event){event.preventDefault();var data,node,nodeName,target=event.target;(target.classList.contains("c-puzzle__hexagon")||target.classList.contains("c-pieces__piece"))&&(data=event.dataTransfer.getData("text"),node=App.Utils.DOM.id(data),nodeName=target.nodeName,this.cacheDOM.swapAudio.play(),"IMG"===nodeName?(node.classList.contains("c-pieces__piece--fromBottom")&&(target.classList.add("c-pieces__piece--fromBottom"),node.classList.remove("c-pieces__piece--fromBottom")),App.Utils.DOM.swapElements(target,node)):target.appendChild(node),node.classList.contains("c-pieces__piece--fromBottom")&&(node.classList.remove("c-pieces__piece--fromBottom"),this.model.decreaseMissingPieces()),this._estimateWrongPieces())},_handleDeskDrop:function(event){event.preventDefault();var data=event.dataTransfer.getData("text"),node=App.Utils.DOM.id(data);event.target.classList.contains("c-pieces__piece")?event.target.parentNode.insertBefore(node,event.target):event.target.appendChild(node),node.classList.contains("c-pieces__piece--fromBottom")||(node.classList.add("c-pieces__piece--fromBottom"),this.model.increaseMissingPieces()),this._estimateWrongPieces(),this.cacheDOM.swapAudio.play()},enablePuzzleImg:function(){this.cacheDOM.unsolvedImg.classList.remove("c-puzzle__img--disabled")},disablePuzzleImg:function(){this.cacheDOM.unsolvedImg.classList.add("c-puzzle__img--disabled")},pauseBackgroundSound:function(){this.cacheDOM.backgroundAudio.pause()},playBackgroundSound:function(){this.cacheDOM.backgroundAudio.play()},_allowDrop:function(event){event.preventDefault()},_estimateWrongPieces:function(){var wrng,list=App.Utils.Array.toArr(this.cacheDOM.hexagons);wrng=list.filter(function(hexagon){return hexagon.children.length>0}).filter(function(hexagon){var child=hexagon.firstElementChild;return hexagon.getAttribute("data-piece")!==child.getAttribute("data-piece")}),this.model.setWrongPieces(wrng.length)},showTip:function(){var self=this,tipsTime=self.model.getTipsTime(),timer=new App.DateTime.Timer(tipsTime),img=document.createElement("IMG");img.classList.add("c-puzzle__img"),img.classList.add("c-puzzle__img--solved"),img.setAttribute("src","assets/img/puzzle_solved.png"),img.setAttribute("alt","Solved Puzzle"),this.cacheDOM.puzzleView.append(img),timer.start(),timer.on(timer.ID+"-elapsedTime",function(){img.remove(),self.model.resumeGame()})},bindEvents:function(){function preView(){self.gameLevel=self.model.getGameLevel(),self.initCountDown(),self.showPuzzle(),self.countDownTimer.start()}function reorganizePuzzle(){self.removePieces(),self.shuffleAndAddPieces(),self.model.start(),self.playBackgroundSound()}function handleDragAndDrop(){self.handleDrag(),self.handleDrop(),self.playBackgroundSound(),self.enablePuzzleImg()}function disableDragAndDrop(){self.disableDrag(),self.disableDrop(),self.pauseBackgroundSound(),self.disablePuzzleImg()}var self=this;App.Utils.Events.$prefixedOn(this.cacheDOM.pieces[0],"animationend",reorganizePuzzle),this.model.on("model.pre-start",preView),this.model.on("model.start",handleDragAndDrop),this.model.on("model.updateTips",this.showTip.bind(this)),this.model.on("model.pauseGame",disableDragAndDrop),this.model.on("model.resumeGame",handleDragAndDrop),this.model.on("model.winnerUSER",this.pauseBackgroundSound.bind(this)),this.model.on("model.gameOver",disableDragAndDrop)}},PuzzleViewModel}(window);